---
title: "Mixed effects analysis of Experiments 1 and 2"
author: Ian Hussey (ian.hussey@ugent.be)
output: 
  html_notebook:
    highlight: haddock
    toc: yes
  pdf_document: 
    highlight: haddock
    toc: yes
---

NB Only rating scales are common to both studies

NB R treats the two conditions alphabetically (i.e., insects, flowers), so that all effects
sizes are retured as negative despite being in line with the hypotheses.
All are inverted when reported in the manuscript to make the reported
results congruent with the wording of the hypothesis.

```{r dependencies, message=FALSE, warning=FALSE}
library(tidyverse)
library(psych)
library(BayesFactor)
library(afex)
```

```{r acquire data}
# experiment 1
exp1_df <- 
  read.csv("/Users/Ian/Dropbox/Work/Manuscripts/Hussey & De Houwer - the IAT as an analogical learning task/Experiment 1/Data/processed data.csv") %>%  
  select(participant,
         condition,
         block_order,
         ratings_pre,
         ratings_post,
         ratings_change_scores) %>%  # select only necessary columns
  mutate(experiment = 1,
         unique_identifier = paste(experiment, participant, sep = "_"),
         ratings_pre_Z_scores = as.numeric(scale(ratings_pre,  # convert ratings to z scores
                                                    center = TRUE,  # i.e., deduct rows from mean
                                                    scale = TRUE)),
         ratings_post_Z_scores = as.numeric(scale(ratings_post,  # convert ratings to z scores
                                                    center = TRUE,  # i.e., deduct rows from mean
                                                    scale = TRUE)),
         ratings_change_Z_scores = as.numeric(scale(ratings_change_scores,  # convert ratings to z scores
                                                    center = TRUE,  # i.e., deduct rows from mean
                                                    scale = TRUE)))  # i.e., devide by SD

# experiment 2
exp2_df <- 
  read.csv("/Users/Ian/Dropbox/Work/Manuscripts/Hussey & De Houwer - the IAT as an analogical learning task/Experiment 2/Data/processed data.csv") %>%  # acquire data
  select(participant,
         condition,
         block_order,
         ratings_pre,
         ratings_post,
         ratings_change_scores) %>%  # select only necessary columns
  mutate(experiment = 2,
         unique_identifier = paste(experiment, participant, sep = "_"),
         ratings_pre_Z_scores = as.numeric(scale(ratings_pre,  # convert ratings to z scores
                                                 center = TRUE,  # i.e., deduct rows from mean
                                                 scale = TRUE)),
         ratings_post_Z_scores = as.numeric(scale(ratings_post,  # convert ratings to z scores
                                                  center = TRUE,  # i.e., deduct rows from mean
                                                  scale = TRUE)),
         ratings_change_Z_scores = as.numeric(scale(ratings_change_scores,  # convert ratings to z scores
                                                    center = TRUE,  # i.e., deduct rows from mean
                                                    scale = TRUE)))  # i.e., devide by SD

# combine data
combined_df <- 
  full_join(exp1_df, exp2_df) %>%
  select(unique_identifier, 
         experiment,
         condition, 
         block_order,
         ratings_pre_Z_scores,
         ratings_post_Z_scores,
         ratings_change_Z_scores) %>%
  mutate(experiment = as.factor(experiment),
         condition = as.factor(condition),
         block_order = as.factor(block_order))
```

# Hypothesis tests

## Differences in ratings changes between conditions

Experiment entered as a random factor

### Frequentist

```{r}
model_1 <- afex::mixed(ratings_change_Z_scores ~ condition + (1 | experiment), 
                       contrasts = TRUE,  
                       data = combined_df,
                       type = 3,  # sum of squares
                       method = "KR",
                       progress = TRUE, 
                       return = "mixed")

summary(model_1)
print(model_1)  # same as using anova() here
```

#### Bayes factors

```{r}
anovaBF(ratings_change_Z_scores ~ condition + experiment, 
        whichRandom = "experiment",
        data = combined_df,
        rscaleFixed = "medium",
        multicore = TRUE)
```

# Exploratory tests

## Influence of block order on the effect

Experiment entered as a random factor

### Frequentist

```{r}
model_2 <- afex::mixed(ratings_change_Z_scores ~ condition * block_order + (1 | experiment), 
                       contrasts = TRUE,  
                       data = combined_df,
                       type = 3,  # sum of squares
                       method = "KR",
                       progress = TRUE, 
                       return = "mixed")

summary(model_2)
print(model_2)  # same as using anova() here
```

#### Bayes factors

```{r}
anovaBF(ratings_change_Z_scores ~ condition * block_order + experiment, 
        whichRandom = "experiment",
        data = combined_df,
        rscaleFixed = "medium",
        multicore = TRUE)
```

